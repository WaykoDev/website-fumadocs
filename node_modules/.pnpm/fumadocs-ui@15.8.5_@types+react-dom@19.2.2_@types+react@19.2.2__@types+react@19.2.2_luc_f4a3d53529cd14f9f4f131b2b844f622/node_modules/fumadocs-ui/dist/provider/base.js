'use client';
import { jsx as _jsx } from "react/jsx-runtime";
import { ThemeProvider } from 'next-themes';
import { lazy, useMemo, useRef, } from 'react';
import { DirectionProvider } from '@radix-ui/react-direction';
import { SidebarProvider } from '../contexts/sidebar.js';
import { SearchProvider } from '../contexts/search.js';
import { defaultTranslations, I18nContext, } from '../contexts/i18n.js';
import { usePathname, useRouter } from 'fumadocs-core/framework';
const DefaultSearchDialog = lazy(() => import('../components/dialog/search-default.js'));
export function RootProvider({ children, dir = 'ltr', theme = {}, search, i18n, }) {
    let body = children;
    if (search?.enabled !== false)
        body = (_jsx(SearchProvider, { SearchDialog: DefaultSearchDialog, ...search, children: body }));
    if (theme?.enabled !== false)
        body = (_jsx(ThemeProvider, { attribute: "class", defaultTheme: "system", enableSystem: true, disableTransitionOnChange: true, ...theme, children: body }));
    if (i18n) {
        body = _jsx(I18nProvider, { ...i18n, children: body });
    }
    return (_jsx(DirectionProvider, { dir: dir, children: _jsx(SidebarProvider, { children: body }) }));
}
function I18nProvider({ locales = [], locale, onLocaleChange, children, translations, }) {
    const router = useRouter();
    const pathname = usePathname();
    const onChange = (value) => {
        if (onLocaleChange) {
            return onLocaleChange(value);
        }
        const segments = pathname.split('/').filter((v) => v.length > 0);
        // If locale prefix hidden
        if (segments[0] !== locale) {
            segments.unshift(value);
        }
        else {
            segments[0] = value;
        }
        router.push(`/${segments.join('/')}`);
    };
    const onChangeRef = useRef(onChange);
    onChangeRef.current = onChange;
    return (_jsx(I18nContext.Provider, { value: useMemo(() => ({
            locale,
            locales,
            text: {
                ...defaultTranslations,
                ...translations,
            },
            onChange: (v) => onChangeRef.current(v),
        }), [locale, locales, translations]), children: children }));
}
